<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Embedded Video</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        background: #000;
        color: #fff;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      }
      .container {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        background: #000;
      }
      .inner {
        width: 100%;
        height: 100%;
        display: grid;
        place-items: center;
      }
      iframe, video {
        width: 100%;
        height: 100%;
        border: 0;
      }
      .fallback {
        color: #ddd;
        padding: 1rem;
        text-align: center;
      }
      .fallback a { color: #76a9ff; }
    </style>
  </head>
  <body>
    <div class="container">
      <div id="mount" class="inner"></div>
    </div>
    <script>
      (function(){
        function getParam(name) {
          try {
            var u = new URL(window.location.href);
            return u.searchParams.get(name) || '';
          } catch (_) { return ''; }
        }

        function createYouTubeEmbed(url) {
          try {
            var id = null;
            if (/youtu\.be\//.test(url)) {
              id = url.split('youtu.be/')[1].split(/[?&#]/)[0];
            } else {
              var u = new URL(url);
              if (u.searchParams.get('v')) id = u.searchParams.get('v');
              if (!id && /\/embed\//.test(u.pathname)) {
                id = u.pathname.split('/embed/')[1].split(/[?&#]/)[0];
              }
            }
            if (!id) return null;
            var src = 'https://www.youtube.com/embed/' + id + '?autoplay=1&mute=1&playsinline=1&rel=0';
            var i = document.createElement('iframe');
            i.src = src;
            i.allow = 'autoplay; fullscreen; picture-in-picture';
            i.referrerPolicy = 'no-referrer-when-downgrade';
            i.loading = 'lazy';
            return i;
          } catch(_) { return null; }
        }

        function createInstagramEmbed(url) {
          try {
            // Convert various Instagram reel/post URLs into embed endpoints
            var shortcode = null;
            var m = url.match(/instagram\.com\/(?:reel|p)\/([^/?#]+)/i);
            if (m && m[1]) shortcode = m[1];
            var block = document.createElement('blockquote');
            block.className = 'instagram-media';
            block.setAttribute('data-instgrm-permalink', url);
            block.style = 'margin:0 auto; background:#000;';
            var s = document.createElement('script');
            s.async = true;
            s.src = 'https://www.instagram.com/embed.js';
            return { node: block, script: s };
          } catch(_) { return null; }
        }

        function createTikTokEmbed(url) {
          try {
            var block = document.createElement('blockquote');
            block.className = 'tiktok-embed';
            block.setAttribute('cite', url);
            block.style = 'margin:0 auto; background:#000;';
            var section = document.createElement('section');
            block.appendChild(section);
            var s = document.createElement('script');
            s.async = true;
            s.src = 'https://www.tiktok.com/embed.js';
            return { node: block, script: s };
          } catch(_) { return null; }
        }

        function createDirectVideo(url) {
          var v = document.createElement('video');
          v.src = url;
          v.controls = true;
          v.autoplay = true;
          v.muted = true;
          v.playsInline = true;
          return v;
        }

        var mount = document.getElementById('mount');
        var url = getParam('url');
        var videoId = getParam('id');

        if (!url) {
          mount.innerHTML = '<div class="fallback">No video URL provided.</div>';
          return;
        }

        // Decide platform
        var lower = url.toLowerCase();
        var appendedScript = null;

        if (lower.includes('youtube.com') || lower.includes('youtu.be')) {
          var yt = createYouTubeEmbed(url);
          if (yt) mount.appendChild(yt); else mount.innerHTML = '<div class="fallback">Unable to embed YouTube video. <a target="_blank" rel="noopener" href="' + url + '">Open</a></div>';
          return;
        }

        if (lower.includes('instagram.com')) {
          var ig = createInstagramEmbed(url);
          if (ig) {
            mount.appendChild(ig.node);
            document.body.appendChild(ig.script);
          } else {
            mount.innerHTML = '<div class="fallback">Unable to embed Instagram content. <a target="_blank" rel="noopener" href="' + url + '">Open</a></div>';
          }
          return;
        }

        if (lower.includes('tiktok.com')) {
          var tt = createTikTokEmbed(url);
          if (tt) {
            mount.appendChild(tt.node);
            document.body.appendChild(tt.script);
          } else {
            mount.innerHTML = '<div class="fallback">Unable to embed TikTok content. <a target="_blank" rel="noopener" href="' + url + '">Open</a></div>';
          }
          return;
        }

        var directVideo = null;

        if (/(\.mp4|\.webm|\.mov)(\?|#|$)/i.test(lower)) {
          directVideo = createDirectVideo(url);
          if (directVideo) {
            directVideo.addEventListener('play', function(){
              try {
                window.parent.postMessage({ type: 'video-gallery-playing', id: videoId }, '*');
              } catch (_) {}
            });
          }
          mount.appendChild(directVideo);
        } else {
          // Fallback
          mount.innerHTML = '<div class="fallback">Unsupported video source. <a target="_blank" rel="noopener" href="' + url + '">Open original</a></div>';
        }

        return;
      })();
    </script>
  </body>
  </html>


